<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="lib/d3.v5.min.js"></script>
    <script src="lib/d3-scale-chromatic.v1.min.js"></script>
    <script src="lib/topojson.v2.min.js"></script>
    <script src="lib/d3-tip.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>HW2</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:300" rel="stylesheet">
    <style>

      .counties {
        fill: none;
        stroke: #fff;
        stroke-linejoin: round;
        stroke-width: .1;
      }

      .states {
        fill: none;
        stroke: #fff;
        stroke-linejoin: round;
        stroke-width: 1.5;
      }

      .d3-tip {
        line-height: 1;
        padding: 6px;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        border-radius: 4px;
        font-size: 12px;
      }

      .d3-tip:after {
        box-sizing: border-box;
        display: inline;
        font-size: 10px;
        width: 100%;
        line-height: 1;
        color: rgba(0, 0, 0, 0.8);
        content: "\25BC";
        position: absolute;
        text-align: center;
      }

      .d3-tip.n:after {
        margin: -2px 0 0 0;
        top: 100%;
        left: 0;
      }
      .bar {
        fill:#757575 ;
      }
      .bar:hover {
        fill: #65AFFF;
        cursor: pointer;
      }
      .mainChart{
        float:left;
      }
      .detailsChart{
        float: left;
      }

      .labelSmall {
        font-size: 10px;
        color: #E6E6E6;
        font-family: courier, Verdana, sans-serif;
      }


      .labelBig {
        font-size: 12px;
        color: #E6E6E6;
        font-family: courier, Verdana, sans-serif;
      }


      .dot {
          fill: #ffab00;
          stroke: #fff;
      }

      .line {
          fill: none;
          stroke: #ffab00;
          stroke-width: 3;
      }

      path.link {
        fill: none;

      }

      .circle {
        fill: #FFEE93;
        stroke: #FFC09F;
      //  stroke: black;
        stroke-width: 1.5px;
      }

      .fixed {
        fill: #FFC09F;
        stroke: #fff;
        stroke: black;
        stroke-width: 1.5px;
      }
      text {
        fill: #000;
        font: 10px sans-serif;
        pointer-events: none;
      }
      body {
        font: 11px sans-serif;
      }
      .axis path,
      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }
      .dot {
        fill-opacity: 0;
      }
      axis path, .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }
      .point {
        fill: steelblue;
        stroke: #000;
      }
      .tooltip {
        position: absolute;
        width: 200px;
        height: 28px;
        pointer-events: none;
      }

      body {
        font: 11px sans-serif;
        text-align: center;
      }

      .legend {
        font-family: Consolas, courier;
      }
      rect.bordered {
        stroke: #E6E6E6;
        stroke-width:2px;
      }

      text.mono {
        font-size: 9pt;
        font-family: Consolas, courier;
        fill: #aaa;
      }

      .title {
        font-family: Consolas, courier;
        font-size:16pt;
        fill: #000f;
        text-align: center;
      }

      .axis{
        fill: #000;
        stroke-width:0px;
        font-family: Consolas, courier;
        fill: #aaa;
        font-size: 10pt;
      }




      @media only screen and (max-width:680px) {
        /* For mobile phones: */
      }
    </style>
  </head>
  <div id="areaz" style="position:static"></div>
  <div id="area1" style="position:static"></div>
  <div id="area2" style="position:static"></div>
  <div id="area3" style="position:static"></div>
  <div id="area4" style="position:static"></div>
  <div id="area5" style="position:static"></div>
  <div id="area6" style="position:static">
    <div id="title1"></div>
    <div id="dropdown"></div>
  </div>
  <div id="area7" style="position:static">
    <svg id="area7-1" class="mainChart" width="760" height="200"></svg>
    <svg id="area7-1" class="detailsChart" width="200" height="200"></svg>
  </div>
  <div id="area8" style="position:static">
    <svg id = "map" width="960" height="600"></svg>
  </div>
  <body>
    <script>
      // get the data
      links =  [
        {
          "source": "Green Bay Packers",
          "target": "Kansas City Chiefs",
          "value": 0
        },
        {
          "source": "Green Bay Packers",
          "target": "Oakland Raiders",
          "value": 0
        },
        {
          "source": "New York Jets",
          "target": "Baltimore Colts",
          "value": 1
        },
        {
          "source": "Kansas City Chiefs",
          "target": "Minnesota Vikings",
          "value": 1
        },
        {
          "source": "Baltimore Colts",
          "target": "Dallas Cowboys",
          "value": 1
        },
        {
          "source": "Dallas Cowboys",
          "target": "Miami Dolphins",
          "value": 0
        },
        {
          "source": "Miami Dolphins",
          "target": "Washington Redskins",
          "value": 1
        },
        {
          "source": "Miami Dolphins",
          "target": "Minnesota Vikings",
          "value": 1
        },
        {
          "source": "Pittsburgh Steelers",
          "target": "Minnesota Vikings",
          "value": 1
        },
        {
          "source": "Pittsburgh Steelers",
          "target": "Dallas Cowboys",
          "value": 1
        },
        {
          "source": "Oakland Raiders",
          "target": "Minnesota Vikings",
          "value": 1
        },
        {
          "source": "Dallas Cowboys",
          "target": "Denver Broncos",
          "value": 0
        },
        {
          "source": "Pittsburgh Steelers",
          "target": "Los Angeles Rams",
          "value": 1
        },
        {
          "source": "Oakland Raiders",
          "target": "Philadelphia Eagles",
          "value": 1
        },
        {
          "source": "San Francisco 49ers",
          "target": "Cincinnati Bengals",
          "value": 0
        },
        {
          "source": "Washington Redskins",
          "target": "Miami Dolphins",
          "value": 0
        },
        {
          "source": "Los Angeles Raiders",
          "target": "Washington Redskins",
          "value": 1
        },
        {
          "source": "San Francisco 49ers",
          "target": "Miami Dolphins",
          "value": 0
        },
        {
          "source": "Chicago Bears",
          "target": "New England Patriots",
          "value": 0
        },
        {
          "source": "New York Giants",
          "target": "Denver Broncos",
          "value": 0
        },
        {
          "source": "Washington Redskins",
          "target": "Denver Broncos",
          "value": 0
        },
        {
          "source": "San Francisco 49ers",
          "target": "Denver Broncos",
          "value": 0
        },
        {
          "source": "New York Giants",
          "target": "Buffalo Bills",
          "value": 0
        },
        {
          "source": "Washington Redskins",
          "target": "Buffalo Bills",
          "value": 0
        },
        {
          "source": "Dallas Cowboys",
          "target": "Buffalo Bills",
          "value": 0
        },
        {
          "source": "San Francisco 49ers",
          "target": "San Diego Chargers",
          "value": 0
        },
        {
          "source": "Dallas Cowboys",
          "target": "Pittsburgh Steelers",
          "value": 0
        },
        {
          "source": "Green Bay Packers",
          "target": "New England Patriots",
          "value": 0
        },
        {
          "source": "Denver Broncos",
          "target": "Green Bay Packers",
          "value": 1
        },
        {
          "source": "Denver Broncos",
          "target": "Atlanta Falcons",
          "value": 1
        },
        {
          "source": "St. Louis Rams",
          "target": "Tennessee Titans",
          "value": 0
        },
        {
          "source": "Baltimore Ravens",
          "target": "New York Giants",
          "value": 1
        },
        {
          "source": "New England Patriots",
          "target": "St. Louis Rams",
          "value": 1
        },
        {
          "source": "Tampa Bay Buccaneers",
          "target": "Oakland Raiders",
          "value": 0
        },
        {
          "source": "New England Patriots",
          "target": "Carolina Panthers",
          "value": 1
        },
        {
          "source": "New England Patriots",
          "target": "Philadelphia Eagles",
          "value": 1
        },
        {
          "source": "Pittsburgh Steelers",
          "target": "Seattle Seahawks",
          "value": 1
        },
        {
          "source": "Indianapolis Colts",
          "target": "Chicago Bears",
          "value": 1
        },
        {
          "source": "New York Giants",
          "target": "New England Patriots",
          "value": 0
        },
        {
          "source": "Pittsburgh Steelers",
          "target": "Arizona Cardinals",
          "value": 1
        },
        {
          "source": "New Orleans Saints",
          "target": "Indianapolis Colts",
          "value": 0
        },
        {
          "source": "Green Bay Packers",
          "target": "Pittsburgh Steelers",
          "value": 0
        },
        {
          "source": "Baltimore Ravens",
          "target": "San Francisco 49ers",
          "value": 1
        },
        {
          "source": "Seattle Seahawks",
          "target": "Denver Broncos",
          "value": 0
        },
        {
          "source": "New England Patriots",
          "target": "Seattle Seahawks",
          "value": 1
        },
        {
          "source": "Denver Broncos",
          "target": "Carolina Panthers",
          "value": 1
        },
        {
          "source": "New England Patriots",
          "target": "Atlanta Falcons",
          "value": 1
        },
        {
          "source": "Philadelphia Eagles",
          "target": "New England Patriots",
          "value": 0
        }];

      var nodes = {};
      var degrees = {};
      //console.log(links);
      // Compute the distinct nodes from the links.
      links.forEach(function(link) {
          if(typeof degrees[link.source] == "undefined"){
            degrees[link.source] = 1;
          } else {
            degrees[link.source] = degrees[link.source] + 1;
          }
          if(typeof degrees[link.target] == "undefined"){
            degrees[link.target] = 1;
          } else{
            degrees[link.target] = degrees[link.target] + 1;
          }
          link.source = nodes[link.source] ||
              (nodes[link.source] = {name: link.source});
          link.target = nodes[link.target] ||
              (nodes[link.target] = {name: link.target});

      });

      var width = 1200,
          height = 700;

      var force = d3.forceSimulation()
          .nodes(d3.values(nodes))
          .force("link", d3.forceLink(links).distance(60))
          .force('center', d3.forceCenter(width / 2, height / 2))
          .force("x", d3.forceX())
          .force("y", d3.forceY())
          .force("charge", d3.forceManyBody().strength(-250))
          .alphaTarget(1)
          .on("tick", tick);

      var svg = d3.select("#areaz").append("svg")
          .attr("width", width)
          .attr("height", height);

      // add the links and the arrows

      var path = svg.append("g")
        .selectAll("path")
        .data(links)
        .enter()
        .append("path")
        .attr("class", function(d) { return "link " + d.type; });


      // define the nodes
      var node = svg.selectAll(".node")
          .data(force.nodes())
        .enter().append("g")
          .attr("class", "node")
          .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended)
            );

      // add the nodes3
      node.append("circle")
          .attr("class","circle")
          .attr("r", function(d) {
            weight = degrees[d.name];
            var minRadius = 3;
            return minRadius + (weight*2);
          })
          .on("dblclick", dblclick);

      var textWidth = {};


      /// add the labels
      node.append("text")
          .attr("dx", "0px")
          .attr("dy", "20px")
          .text(function(d) {
            return d.name })
            .each(function(d,i){
              textWidth[d.name] = this.getComputedTextLength();
              this.remove();
            });

      node.append("text")
          .attr("dx", function(d){
            return -textWidth[d.name]/2;
          })
          .attr("dy","18px")
          .text(function(d) {
            return d.name });

      // add the curvy lines
      function tick() {
          path.attr("d", function(d) {
              var dx = d.target.x - d.source.x,
                  dy = d.target.y - d.source.y,
                  dr = Math.sqrt(dx * dx + dy * dy);
              return "M" +
                  d.source.x + "," +
                  d.source.y + "A" +
                  dr + "," + dr + " 0 0,1 " +
                  d.target.x + "," +
                  d.target.y;
          });

          path.attr("stroke", function(d) {
            //console.log(d.index)
            if(d.value == 0){

              return "#ADF7B6";
            } else if(d.value == 1){
              return "#79ADDC";
            }
          });

          path.attr("stroke-width", function(d){
            if(d.value == 0){
              return 4;
            } else if(d.value == 1){
              return 2;
            }
          });

          node.attr("transform", function(d) {
              return "translate(" + d.x + "," + d.y + ")"; });
      };

      function dragstarted(d) {
            if (!d3.event.active) force.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
          };

      function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
      };

      function dblclick(d) {
        if(typeof d.fixed == "undefined"){
          d.fixed = false;
        };
        console.log(d.name, d.fixed);
        d.fixed = !d.fixed;
        console.log(d.name, d.fixed, d3.event.active);
        if(d.fixed == true){
          d.fx = d.x;
          d.fy = d.y;
          d3.select(this).attr("class", "fixed");
        } else{
          d.fx = null;
          d.fy = null;
          d3.select(this).attr("class","circle");
        }
      }

      function dragended(d) {
        if (!d3.event.active) force.alphaTarget(0);
        if (d.fixed == true){
           d.fx = d.x;
           d.fy = d.y;
        }
        else{
          d.fx = null;
          d.fy = null;
        }
      };
    </script>

    <script>
      document.getElementById("area1").style.pageBreakAfter = "always";
      document.getElementById("area2").style.pageBreakAfter = "always";
      document.getElementById("area3").style.pageBreakAfter = "always";
      document.getElementById("area4").style.pageBreakAfter = "always";
      document.getElementById("area5").style.pageBreakAfter = "always";
      var margin = {top: 50, right: 20, bottom: 30, left: 80},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

      // setup x
      var xValue = function(d) { return parseFloat(d.Rating);}, // data -> value
          xScale = d3.scaleLinear().range([0, width]), // value -> display
          xMap = function(d) { return xScale(xValue(d));}, // data -> display
          xAxis = d3.axisBottom().scale(xScale);

      // setup y
      var yValue = function(d) { return parseInt(d.WinsNoms)}, // data -> value
          yScale = d3.scaleLinear().range([height, 0]).nice(), // value -> display
          yMap = function(d) {return yScale(yValue(d));}, // data -> display
          yAxis = d3.axisLeft().scale(yScale);
      // setup second y variable

      var yValue2 = function(d) { return parseInt(d.Budget)}, // data -> value
          yScale2 = d3.scaleLinear().range([height, 0]), // value -> display
          yMap2 = function(d) {
            return yScale2(yValue2(d));}, // data -> display
          yAxis2 = d3.axisLeft().scale(yScale2);

      var yValue3 = function(d) { return parseInt(d.Votes)}, // data -> value
          yScale3 = d3.scaleLinear().range([height, 0]), // value -> display
          yMap3 = function(d) { return yScale3(yValue3(d));}, // data -> display
          yAxis3 = d3.axisLeft().scale(yScale3);

      var yValue4 = function(d) { return parseInt(d.Votes)}, // data -> value
          yScale4 = d3.scaleSqrt().range([height, 0]), // value -> display
          yMap4 = function(d) { return yScale4(yValue4(d));}, // data -> display
          yAxis4 = d3.axisLeft().scale(yScale4);

      var yValue5 = function(d) { return parseInt(d.Votes)}, // data -> value
          yScale5 = d3.scaleLog().clamp(true).range([height, 0]).nice(), // value -> display
          yMap5 = function(d) { return yScale5(yValue5(d));}, // data -> display
          yAxis5 = d3.axisLeft().scale(yScale5);



      //var shapeScale = d3.scaleOrdinal

          var min = 200;
          var max = null;
          var symbols = d3.scaleOrdinal(d3.symbols);
          var symbol = d3.symbol().size(100);
      //get min and max. Take difference and place the current
      var sizeValue = function(d) { return d.Votes};

      // add the graph canvas to the body of the webpage
      var chart1 = d3.select("#area1").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var chart2 = d3.select("#area2").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var chart3 = d3.select("#area3").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var chart4 = d3.select("#area4").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var chart5 = d3.select("#area5").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // add the tooltip area to the webpage
      var tooltip = d3.select("body").append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

      //console.log(min, max);
      data = d3.csv("Q3/movies.csv").then(function(data){
              data.Rating = +data.Rating;
              data.WinsNoms = +data.WinsNoms;
              data.IsGoodRating = +data.IsGoodRating;
              data.Budget = +data.Budget;
              data.Votes = +data.Votes;

              data.forEach(function(d){
                if(parseInt(d.WinsNoms) < min){
                  min = d.WinsNoms;
                } else if(parseInt(d.WinsNoms) >= max){
                  max = d.WinsNoms;
                }
              })

            //console.log(min, max);


          // don't want dots overlapping axis, so add in buffer to data domain
            xScale.domain([d3.min(data, xValue)-1, d3.max(data, xValue)+1]);
            yScale.domain([d3.min(data, yValue)-1, d3.max(data, yValue)+1]);
            yScale2.domain([d3.min(data, yValue2)-1, d3.max(data, yValue2)+1]);
            yScale3.domain([d3.min(data, yValue3)-1, d3.max(data, yValue3)+1]);
            yScale4.domain([d3.min(data, yValue4)-1, d3.max(data, yValue4)+1]);
            yScale5.domain([d3.min(data, yValue5)-1, d3.max(data, yValue5)+1]);

            //yScale2.domain([d3.min(data, yValue2)-1, d3.max(data, yValue2)+1]);

            // draw legend colored rectangles


            chart1.append("text")
               .attr("x",(width/2))
               .attr("y",10)
               .attr("text-anchor","middle")
               .text("Wins+Nominations vs. Rating");

            // x-axis
            chart1.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            chart1.append("text")
                .attr("class", "label")
                .attr("x", width)
                .attr("y", height-10)
                .style("text-anchor", "end")
                .text("Rating");

            // y-axis
            chart1.append("g")
                .attr("class", "y axis")
                .call(yAxis);

            chart1.append("text")
              .attr("class", "label")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", ".71em")
              .style("text-anchor", "end")
              .text("Wins+Nominations");

            // draw dots
            chart1.selectAll(".dot")
                .data(data)
              .enter().append("circle")
                .attr("class", "dot")
                //.attr("d", d3.symbol().type(d3.symbolCross))
                .attr("r", 3.5)
                .attr("cx", xMap)
                .attr("cy", yMap)
                .style("stroke", function(d) {
                  if(d.IsGoodRating == 1){
                    return('blue');
                  } else{ return 'red'};})
                .on("mouseover", function(d) {
                    tooltip.transition()
                         .duration(200)
                         .style("opacity", .9);
                    tooltip.html(d.Title + "<br/> (" + xValue(d)
                    + ", " + yValue(d) + ")")
                         .style("left", (d3.event.pageX + 5) + "px")
                         .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function(d) {
                    tooltip.transition()
                         .duration(500)
                         .style("opacity", 0);
                });


                // draw legend
                var legend1 = chart1.selectAll(".legend")
                    .data(['Good Rating','Bad Rating'])
                  .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function(d, i) { return "translate(0," + i*18 + ")"; });

                   legend1.append("rect")
                        .attr("x", width - 18)
                        .attr("width", 18)
                        .attr("height", 18)
                        .style("fill", function(d){
                          if(d=="Good Rating"){
                            return 'blue'}
                            else{return 'red'};
                        });

                // draw legend text
                    legend1.append("text")
                        .attr("x", width - 24)
                        .attr("y", 9)
                        .attr("dy", ".35em")
                        .style("text-anchor", "end")
                      .text(function(d) { return d;})


                chart2.append("text")
                   .attr("x",(width/2))
                   .attr("y",10)
                   .attr("text-anchor","middle")
                   .text("Budget vs. Rating");

                chart2.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);

                chart2.append("text")
                    .attr("class", "label")
                    .attr("x", width)
                    .attr("y", height-10)
                    .style("text-anchor", "end")
                    .text("Rating");

                // y-axis
                chart2.append("g")
                    .attr("class", "y axis")
                    .call(yAxis2);
                  chart2.append("text")
                    .attr("class", "label")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Budget");






                // draw dots
                chart2.selectAll(".dot")
                    .data(data)
                  .enter().append("circle")
                    .attr("class", "dot")
                    .attr("r", 3.5)
                    .attr("cx", xMap)
                    .attr("cy", yMap2)
                    .attr("d", d3.symbol().type(d3.symbolTriangle))
                    .style("stroke", function(d) {
                      if(d.IsGoodRating == 1){
                        return('blue');
                      } else{ return 'red'};})
                    .on("mouseover", function(d) {
                        tooltip.transition()
                             .duration(200)
                             .style("opacity", .9);
                        tooltip.html(d.Title + "<br/> (" + xValue(d)
                        + ", " + yValue(d) + ")")
                             .style("left", (d3.event.pageX + 5) + "px")
                             .style("top", (d3.event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        tooltip.transition()
                             .duration(500)
                             .style("opacity", 0);
                    });

                    // draw legend
                    var legend2 = chart2.selectAll(".legend")
                        .data(['Good Rating','Bad Rating'])
                      .enter().append("g")
                        .attr("class", "legend")
                        .attr("transform", function(d, i) { return "translate(0," + i*18 + ")"; });

                       legend2.append("rect")
                            .attr("x", width - 18)
                            .attr("width", 18)
                            .attr("height", 18)
                            .style("fill", function(d){
                              if(d=="Good Rating"){
                                return 'blue'}
                                else{return 'red'};
                            });

                    // draw legend text
                        legend2.append("text")
                            .attr("x", width - 24)
                            .attr("y", 9)
                            .attr("dy", ".35em")
                            .style("text-anchor", "end")
                          .text(function(d) { return d;})





          chart3.append("text")
             .attr("x",(width/2))
             .attr("y",10)
             .attr("text-anchor","middle")
             .text("Votes vs. Rating");


                    chart3.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis);
                      chart3.append("text")
                        .attr("class", "label")
                        .attr("x", width)
                        .attr("y", height-10)
                        .style("text-anchor", "end")
                        .text("Rating");

                    // y-axis
                    chart3.append("g")
                        .attr("class", "y axis")
                        .call(yAxis3);
                      chart3.append("text")
                        .attr("class", "label")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 6)
                        .attr("dy", ".71em")
                        .style("text-anchor", "end")
                        .text("Votes");

                      // draw dots
                      chart3.selectAll(".dot")
                          .data(data)
                        .enter().append("circle")
                          .attr("class", "dot")
                          .attr("r", function(d){
                            //console.log(d.WinsNoms);
                            return ((d.WinsNoms/(max-min))*10+3.5)
                          })
                          //var min = Math.min.apply(Math, d.WinsNoms);
                          //var max = Math.min.apply(Math, d.WinsNoms);
                          .attr("cx", xMap)
                          .attr("cy", yMap3)
                          .attr("d", d3.symbol().type(d3.symbolTriangle))
                          .style("stroke", function(d) {
                            if(d.IsGoodRating == 1){
                              return('blue');
                            } else{ return 'red'};})
                          .on("mouseover", function(d) {
                              tooltip.transition()
                                   .duration(200)
                                   .style("opacity", .9);
                              tooltip.html(d.Title + "<br/> (" + xValue(d)
                              + ", " + yValue(d) + ")")
                                   .style("left", (d3.event.pageX + 5) + "px")
                                   .style("top", (d3.event.pageY - 28) + "px");
                          })
                          .on("mouseout", function(d) {
                              tooltip.transition()
                                   .duration(500)
                                   .style("opacity", 0);
                          });

                          // draw legend
                          var legend3 = chart3.selectAll(".legend")
                              .data(['Good Rating','Bad Rating'])
                            .enter().append("g")
                              .attr("class", "legend")
                              .attr("transform", function(d, i) { return "translate(0," + i*18 + ")"; });

                             legend3.append("rect")
                                  .attr("x", width - 18)
                                  .attr("width", 18)
                                  .attr("height", 18)
                                  .style("fill", function(d){
                                    if(d=="Good Rating"){
                                      return 'blue'}
                                      else{return 'red'};
                                  });

                          // draw legend text
                              legend3.append("text")
                                  .attr("x", width - 24)
                                  .attr("y", 9)
                                  .attr("dy", ".35em")
                                  .style("text-anchor", "end")
                                .text(function(d) { return d;})



            chart4.append("text")
               .attr("x",(width/2))
               .attr("y",10)
               .attr("text-anchor","middle")
               .text("Sqrt of Votes vs. Rating");



      chart4.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);
        chart4.append("text")
          .attr("class", "label")
          .attr("x", width)
          .attr("y", height-10)
          .style("text-anchor", "end")
          .text("Rating");

      // y-axis
      chart4.append("g")
          .attr("class", "y axis")
          .call(yAxis4);
        chart4.append("text")
          .attr("class", "label")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Votes");

        // draw dots
        chart4.selectAll(".dot")
            .data(data)
          .enter().append("circle")
            .attr("class", "dot")
            .attr("r", function(d){
              return ((d.WinsNoms/(max-min))*10+3.5)
            })
            //var min = Math.min.apply(Math, d.WinsNoms);
            //var max = Math.min.apply(Math, d.WinsNoms);
            .attr("cx", xMap)
            .attr("cy", yMap4)
            .attr("d", d3.symbol().type(d3.symbolTriangle))
            .style("stroke", function(d) {
              if(d.IsGoodRating == 1){
                return('blue');
              } else{ return 'red'};})
            .on("mouseover", function(d) {
                tooltip.transition()
                     .duration(200)
                     .style("opacity", .9);
                tooltip.html(d.Title + "<br/> (" + xValue(d)
                + ", " + yValue(d) + ")")
                     .style("left", (d3.event.pageX + 5) + "px")
                     .style("top", (d3.event.pageY - 28) + "px");
            })
            .on("mouseout", function(d) {
                tooltip.transition()
                     .duration(500)
                     .style("opacity", 0);
            });

            // draw legend
            var legend4 = chart4.selectAll(".legend")
                .data(['Good Rating','Bad Rating'])
              .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) { return "translate(0," + i*18 + ")"; });

               legend4.append("rect")
                    .attr("x", width - 18)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", function(d){
                      if(d=="Good Rating"){
                        return 'blue'}
                        else{return 'red'};
                    });

            // draw legend text
                legend4.append("text")
                    .attr("x", width - 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                  .text(function(d) { return d;})


      chart5.append("text")
         .attr("x",(width/2))
         .attr("y",10)
         .attr("text-anchor","middle")
         .text("Log of Votes vs. Rating");

      chart5.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);
        chart5.append("text")
          .attr("class", "label")
          .attr("x", width)
          .attr("y", height-10)
          .style("text-anchor", "end")
          .text("Rating");

      // y-axis
      chart5.append("g")
          .attr("class", "y axis")
          .call(yAxis5);
        chart5.append("text")
          .attr("class", "label")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Votes");

        // draw dots
        chart5.selectAll(".dot")
            .data(data)
          .enter().append("circle")
            .attr("class", "dot")
            .attr("r", function(d){
              return ((d.WinsNoms/(max-min))*10+3.5)
            })
            //var min = Math.min.apply(Math, d.WinsNoms);
            //var max = Math.min.apply(Math, d.WinsNoms);
            .attr("cx", xMap)
            .attr("cy", yMap5)
            .attr("d", d3.symbol().type(d3.symbolTriangle))
            .style("stroke", function(d) {
              if(d.IsGoodRating == 1){
                return('blue');
              } else{ return 'red'};})
            .on("mouseover", function(d) {
                tooltip.transition()
                     .duration(200)
                     .style("opacity", .9);
                tooltip.html(d.Title + "<br/> (" + xValue(d)
                + ", " + yValue(d) + ")")
                     .style("left", (d3.event.pageX + 5) + "px")
                     .style("top", (d3.event.pageY - 28) + "px");
            })
            .on("mouseout", function(d) {
                tooltip.transition()
                     .duration(500)
                     .style("opacity", 0);
            });

            // draw legend
            var legend5 = chart5.selectAll(".legend")
                .data(['Good Rating','Bad Rating'])
              .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) { return "translate(0," + i*18 + ")"; });

               legend5.append("rect")
                    .attr("x", width - 18)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", function(d){
                      if(d=="Good Rating"){
                        return 'blue'}
                        else{return 'red'};
                    });

            // draw legend text
                legend5.append("text")
                    .attr("x", width - 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                  .text(function(d) { return d;})



      });
    </script>

    <script>
      var margin = {top: 30, right: 70, bottom:70, left: 70},
        width = 600 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom,
        colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],
        boroughs = ['Bronx', 'Brooklyn', 'Manhattan', 'Queens', 'Staten Island'],
        crime = ['Assault', 'Burglary', 'Housing', 'Murder', 'Robbery', 'Shooting'],
        years = [2011,2012,2013,2014,2015],
        xDomain = crime,
        yDomain = boroughs,
        x = d3.scaleBand().domain(crime).range([0,width-margin.left-margin.right]),
        y = d3.scaleBand().domain(boroughs).range([0,height-margin.top-margin.bottom]),
        year = 2011,
        p = 2,
        arr = [],
        arrLength = 0;


      var title1 = d3.select("#title1")
        .attr("width", (width+margin.left+margin.right))
        .attr("height", (margin.top*4))
        .append("g")
        ;
      var select3 = d3.select("#dropdown")
        .attr("width", (width+margin.left+margin.right))
        .attr("height", (margin.top*4))
        .append("g")
        .attr("transform", "translate(" + margin.left*2 + "," + margin.top + ")");

      var select = select3
        .append('select')
          .attr('class','select')
          .on('change',onchange)


      var options = select
        .selectAll('option')
        .data(years).enter()
        .append('option')
          .text(function (d) { return d; });

      function onchange() {
        selectValue = d3.select('select').property('value')
        year = (selectValue);
        display2();
      };

      var svg = d3.select("#area6").append("svg")
        .attr("width", (width+margin.left+margin.right))
        .attr("height", (height+margin.top+margin.bottom))
        .append("g")
        .attr("transform", "translate(" + margin.left*2 + "," + margin.top + ")");

      var xAxis = d3.axisBottom()
        .tickSize(0)
        .scale(x);

      var yAxis = d3.axisLeft()
        .tickSize(0)
        .scale(y);

      var colorScale = d3.scaleQuantile().range(colors);

      var colorDomain; // generated dynamically


      svg.append("text")
          .attr("class", "mono")
         .attr("x",-5)
         .attr("y",10)
         .attr("text-anchor","end")
         .text("Borough");

      svg.append("text")
          .attr("x", width-100)
          .attr("y", height-margin.bottom)
          .attr("text-anchor","end")
          .attr("class", "mono")
          .text("Crime");

      title1.append("text")
         .attr("x",200)
         .attr("y",200)
         .attr("text-anchor","start")
         .attr("class", "title")
         .text("Crimes in New York City");


      var legend1 = svg.selectAll(".legend2").append("g")
          .data(colors)
        .enter().append("g")
          .attr("class", "legend2");


      legend1.append("rect")
          .attr("x", function(d, i) {
            return x.bandwidth()/2*i + 30})
          .attr("y", height-(10))
          .attr("width", x.bandwidth()/2)
          .attr("height", y.bandwidth() / 6)
          .style("fill", function(d){
            return d});

      svg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + (height) + ")")
        .call(xAxis)
        .selectAll("text")
          .attr("transform", "rotate(270)")
          .attr("x", function(d,i){
            return margin.bottom-30;
          })
          .attr("y",0)
          .style("text-anchor", "start");

      svg.append("g").attr("class", "axis").call(yAxis);


      svg.append("text")
        .attr("x", width/4)
        .attr("y", height-20)
        .attr("dy", "0.35em")
        .attr("class", "mono")
        .text(function(d){
          return "No. of Crimes";
        });


      var map11 = d3.map();
      var map12 = d3.map();
      var map13 = d3.map();
      var map14 = d3.map();
      var map15 = d3.map();
      var map = d3.map();


      const data = d3.csv("Q4/heatmap.csv", function(d){
        if(parseInt(d.Year)==2011){
          map11.set(d['Crime Type'],[parseInt(d.Bronx), parseInt(d.Brooklyn), parseInt(d.Manhattan), parseInt(d.Queens), parseInt(d['Staten Island'])])}
        else if(parseInt(d.Year)==2012){
          map12.set(d['Crime Type'],[parseInt(d.Bronx), parseInt(d.Brooklyn), parseInt(d.Manhattan), parseInt(d.Queens), parseInt(d['Staten Island'])])}
        else if(parseInt(d.Year)==2013){
          map13.set(d['Crime Type'],[parseInt(d.Bronx), parseInt(d.Brooklyn), parseInt(d.Manhattan), parseInt(d.Queens), parseInt(d['Staten Island'])])}
        else if(parseInt(d.Year)==2014){
          map14.set(d['Crime Type'],[parseInt(d.Bronx), parseInt(d.Brooklyn), parseInt(d.Manhattan), parseInt(d.Queens), parseInt(d['Staten Island'])])}
        else if(parseInt(d.Year)==2015){
          map15.set(d['Crime Type'],[parseInt(d.Bronx), parseInt(d.Brooklyn), parseInt(d.Manhattan), parseInt(d.Queens), parseInt(d['Staten Island'])])}
      });

      data.then(function(){
        display2();
        return display2();
      })

      function display2(){
        var processed = [];
        picker = year;
        for (index=0; index < crime.length; index++){
          for(borough=0; borough<boroughs.length;borough++){
            var count = 0

            if(picker==2011){count = map11.get(crime[index])[borough]}
            else if(picker==2012){count = map12.get(crime[index])[borough]}
            else if(picker==2013){count = map13.get(crime[index])[borough]}
            else if(picker==2014){count = map14.get(crime[index])[borough]}
            else if(picker==2015){count = map15.get(crime[index])[borough]}
            processed.push({'borough':boroughs[borough],'crime':crime[index],'count':count});
          }
        };

        colorDomain = d3.extent(processed, function(entry){
          return parseInt(entry.count);});
        colorScale.domain(d3.range(colorDomain[0],colorDomain[1]));

        var rects = svg.selectAll(".heatmap").data(processed);//cvg was canvas

        //console.log(legend);
        rects.enter().append("rect").attr("class","heatmap");
        rects.exit().transition().duration(1000).remove();

        rects.transition().duration(1000)
          .attr("x", function(d) {
            return x(d.crime) + p / 2; })
          .attr("y", function(d) { return y(d.borough) + p / 2; })
          .attr("width", x.bandwidth() - p)
          .attr("height", y.bandwidth() - p)
          .attr("class", "heatmap bordered")
          .style("fill", function(d) {
            //console.log(d.count, colorScale(d.count));
            return colorScale(d.count); });

        var list2 = Object.values(colorScale.quantiles());
        list2.unshift(0);

        var legend = svg.selectAll(".legend").data(list2);

        legend.exit().remove();

        legend.enter().append("text")
          .attr("class", "legend")
          .attr("x", function(d, i) {
            return x.bandwidth()/2*i + 20})
          .attr("y", height+5)
          .attr("dy", ".35em")
          .attr("dx", "1em")
          .style("text-anchor", "start")
          .merge(legend)
            .text(function(d){
            return parseInt(d);
          });
        }

    </script>

    <script type="text/javascript">
      var data = [{country: 'Bangladesh', population_2012: 105905297, growth: {year_2013:42488 , year_2014:934 , year_2015:52633 , year_2016:112822 , year_2017:160792}},
        {country: 'Ethopia', population_2012: 75656319, growth: {year_2013:1606010 , year_2014:1606705 , year_2015:1600666 , year_2016:1590077 , year_2017:1580805}},
        {country: 'Kenya', population_2012: 33007327, growth: {year_2013:705153 , year_2014:703994 , year_2015:699906 , year_2016:694295 , year_2017:687910}},
        {country: 'Afghanistan', population_2012: 23280573, growth: {year_2013:717151 , year_2014:706082 , year_2015:665025 , year_2016:616262 , year_2017:573643}},
        {country: 'Morocco', population_2012: 13619520, growth: {year_2013:11862 , year_2014:7997 , year_2015:391 , year_2016:-8820 , year_2017:-17029}}];

        yearText = [2013, 2014, 2015, 2015, 2016, 2017],
        countryNameList = [],
        countryPopList = [],
        yearList = Object.keys(data[0]['growth']);

      ///make a list (countryNameList) of all of the the countries
      //Make a list (countryPopList) of key-value objects (Country Name : Population_2012)
      //make a list (yearList) of all of the years ('year_2013')
      for (var index = 0; index < data.length; index++){
        countryNameList.push(data[index]['country']);
        countryPopList.push({name:data[index]['country'],value:data[index]['population_2012']});
      }

      //make svg element and set width, height, and margins
      var svg = d3.select("svg"),
        margin = {top: 20, right: 30, bottom: 30, left: 100},
        axisMargin = 20,
        valueMargin = 4,
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        barHeight = (height-axisMargin*2)*0.2/data.length,
        labelWidth =0;
      //make the x and y scales
      var x = d3.scaleLinear().range([0, width]);
      var y = d3.scaleBand().range([height, 0]);
      var g = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      //iterate over all elements and get their population at the end of the time period
      for (var i = 0; i < data.length; i++){
        var pop = countryPopList[i]['value'];
        for(var p = 0; p < yearList.length; p++){
          pop = pop + data[i]['growth'][yearList[p]];
        }
        countryPopList[i]['value'] = pop;
      }

      countryPopList.sort(function(a, b) {
        return a.value - b.value; });

      x.domain([0, d3.max(countryPopList, function(d) { return d.value; })]);
      y.domain(countryPopList.map(function(d) { return d.name; })).padding(0.1);

      g.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")");

      g.selectAll(".bar")
        .data(countryPopList)
        .enter().append("rect")
          .attr("class", "bar")
          .attr("x", 0)
          .attr("height", y.bandwidth()*.9)
          .attr("y", function(d) {
            return y(d.name); })
          .attr("width", function(d) {
            return x(d.value); })
            .on("mouseover", function(d){
              display(d.name);
            })
            .on("mouseout", function(d){
              hide();

            });

      var labelWidth = {};
      svg.selectAll(".text")
        .data(countryPopList)
        .enter()
        .append("text")
        .attr("class", "labelBig")
        .attr("x", function(d) {return x(d.value)+margin.left;} )
        .attr("y", function(d) {
          return y(d.name)+margin.top+(barHeight*2);} )
        .attr("dy", "0.75em")
        .text(function(d){return (d3.format(',')(d.value));})
        .each(function(d,i){
          labelWidth[d.name] = this.getComputedTextLength();
          this.remove();
        });

      svg.selectAll(".text")
        .data(countryPopList)
        .enter()
        .append("text")
        .attr("class", "labelBig")
        .attr("x", function(d) {
          return x(d.value)+margin.left-labelWidth[d.name]-5;} )
        .attr("y", function(d) {
          return y(d.name)+margin.top+(barHeight*2);} )
        .attr("dy", "0.75em")
        .text(function(d){return (d3.format(',')(d.value));});

      var textWidth = {};

      svg.selectAll(".text")
        .data(countryPopList)
        .enter()
        .append("text")
        .attr("class", "labelBig")
        .attr("x", function(d) {margin.left;} )
        .attr("y", function(d) {
          return y(d.name)+margin.top+barHeight*2;} )
        .attr("dy", "0.75em")
        .text(function(d){return d.name;})
          .each(function(d,i){
            textWidth[d.name] = this.getComputedTextLength();
            this.remove();
          });

      svg.selectAll(".text")
        .data(countryPopList)
        .enter()
        .append("text")
        .attr("class", "labelBig")
        .attr("x", function(d) {
           return  margin.left-textWidth[d.name]-5;})
        .attr("y", function(d) {
          return y(d.name)+margin.top+barHeight*2;} )
        .attr("dy", "0.75em")
        .text(function(d){return d.name;});


      var hide = function(){
        d3.select("#area7-2").selectAll("*").remove();
      }

      var display = function(country){
        d3.select("#area7-2").selectAll("*").remove();
        countryIndex = 0;

        for(var p=0; p< data.length;p++){
          if(country == data[p]['country']){
            countryIndex=p;
          }
        }
        //get beginning population (population_2012) of the selected country
        //Build list of the annual growth rate
        currentPop = data[countryIndex]['population_2012'];
        growthRate=0.0
        growthRateList=[];
        for(var d=0; d<yearList.length;d++){
        currentPop = currentPop + data[countryIndex]['growth'][yearList[d]];
        growthRate = data[countryIndex]['growth'][yearList[d]]/currentPop * 100;
        growthRateList.push({year:d3.timeParse("%Y")(parseInt((yearList[d]).slice(5))), rate:growthRate});
        }

        // set the dimensions and margins of the graph
        var margin = {top: 25, right: 20, bottom: 20, left: 30},
          width = 200 - margin.left - margin.right,
          height = 200 - margin.top - margin.bottom;

        // set the ranges
        var x = d3.scaleTime().domain([
          d3.min(growthRateList,function(d){return (d.year);}),
          d3.max(growthRateList, function(d){return (d.year);})])
          .range([0, width]);

            //var x = d3.scaleOrdinal().domain([2013,2017])
            //  .range([0, width]);

        var y = d3.scaleLinear()
          .domain([d3.min(growthRateList,function(d){return d.rate;}),
            d3.max(growthRateList,function(d){return d.rate;})])
          .range([height, 0]);

        // define the line
        var valueline = d3.line()
          .x(function(d) {return x(d.year);})
          .y(function(d) {return y(d.rate);})
          .curve(d3.curveMonotoneX) ;

        // append the svg obgect to the body of the page
        // appends a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        var svg = d3.select("#area7-2")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Add the valueline path.
        svg.append("path")
          .datum(growthRateList)
          .attr("class", "line")
          .attr("d", valueline);

        svg.selectAll(".dot")
          .data(growthRateList)
          .enter().append("circle") // Uses the enter().append() method
            .attr("class", "dot") // Assign a class for styling
            .attr("cx", function(d) { return x(d.year) })
            .attr("cy", function(d) { return y(d.rate) })
            .attr("r", 5);

        // Add the X Axis
        var xAxis = d3.axisBottom(x)
          .ticks(d3.timeYear)
          .tickFormat(d3.timeFormat("%Y"));

        svg.append("g")
          .call(xAxis)
          .attr("transform", "translate(0," + height + ")");

        // Add the Y Axis
        svg.append("g")
          .call(d3.axisLeft(y));

        svg.append("text")
          .attr("class", "labelSmall")
          .attr("x", width+15)
          .attr("y", height-10)
          .style("text-anchor", "end")
          .text("Year");

        labelLenght=0
        svg.append("text")
          .attr("class", "labelSmall")
          .attr("x", width/2)
          .attr("y", -10)
          .style("text-anchor", "end")
          .text(function(d){
            return "% Pop. change in: "+country;
          }).each(function(d,i){

            labelLength = this.getComputedTextLength();
            console.log(labelLength);
            this.remove();
        });

        svg.append("text")
          .attr("class", "labelSmall")
          .attr("x", width/2 +labelLength/2)
          .attr("y", -15)
          .style("text-anchor", "end")
          .text(function(d){
            return "% Pop. change in: "+country;
          });

        svg.append("text")
          .attr("class", "labelSmall")
          .attr("y", -10)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("Pct %");
      }



    </script>

    <script type="text/javascript">
      var header = d3.select("#map").append("h2")
          .attr("class")

      var div = d3.select("#area8").append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

      var svg = d3.select("#map"),
          width = +svg.attr("width"),
          height = +svg.attr("height");

      svg.append("text")
              .attr("x", (width / 2))
              .attr("y", 20)
              .attr("text-anchor", "middle")
              .style("font-size", "22px")
              .text("Choropleth Map of County Data");

      svg.append("text")
              .attr("x", width - 75)
              .attr("y", height-210)
              .attr("text-anchor", "middle")
              .style("font-size", "22px")
              .text("Poverty Rate");

      var promises = [
        d3.json("Q6/us.json"),
        d3.csv("Q6/county_detail.csv", function(cd){
          cd.TotalPop = +cd.TotalPop;
          cd.IncomePerCap = +cd.IncomePerCap;
          county_detail.set(cd.CensusId, [cd.TotalPop, cd.IncomePerCap]);
        }),
        d3.csv("Q6/county_poverty.csv", function(cp){
           cp.Poverty = +cp.Poverty;
           county_poverty.set(cp.CensusId, [cp.State, cp.County, cp.Poverty]);
        })];

      Promise.all(promises).then(ready);

      var county_detail = d3.map();
      var county_poverty = d3.map();
      var path = d3.geoPath();
      var x = d3.scaleLinear()
        .domain([1,10])
        .rangeRound([600,860]);

      var color = d3.scaleThreshold()
        .domain(d3.range(2,10))
        .range(d3.schemeBlues[9]);

      var g = svg.append("g")
        .attr("class", "key")
        .attr("transform", "translate(0,40)");

      g.append("text")
        .attr("class", "caption")
        .attr("x", x.range()[0])
        .attr("y", -6)
        .attr("fill", "#000")
        .attr("text-anchor", "start");

      var legend1 = svg.selectAll(".legend")
        .data(color.domain())
        .enter().append("g")
          .attr("class", "legend")
          .attr("transform", function(d, i) { return "translate(0," + i*18 + ")"; });

      legend1.append("rect")
        .attr("x", width - 80)
        .attr("y", height - 200)
        .attr("width", 18)
        .attr("height", 18)
          .style("fill", function(d){return color(d)});

          // draw legend text
      legend1.append("text")
        .attr("x", width - 85)
        .attr("y", height-190)
        .attr("dy", ".35em")
          .style("text-anchor", "end")
          .text(function(d,i){
            console.log(i);
            var sign = "";
            if(i==0){
              sign = "<"
            } else if(i==7){
              sign = ">"
            }
            return sign + d + "%";})

      var tip = d3.tip()
        .attr('class','d3-tip')
        .offset([-10,0])
        .html(function(d){
          return "State: "
          + county_poverty.get(d.id)[0]
          + "<br/>County: "+ county_poverty.get(d.id)[1]
          + "<br/>Poverty Rate: "
          +  d.rate + "%<br/>Total Population: "
          +  d3.format(',')(county_detail.get(d.id)[0])
          + "<br/>Income per capita: "
          +  d3.format(',')(county_detail.get(d.id)[1]);
      });

      svg.call(tip);

      function ready([us]) {
        svg.append("g")
          .attr("class", "counties")
          .selectAll("path")
          .data(topojson.feature(us, us.objects.counties).features)
          .enter().append("path")
          .attr("fill", function(d) {
              return color(d.rate = county_poverty.get(d.id)[2]); })
          .attr("d", path)
          .on("mouseover",tip.show)
          .on("mouseout", tip.hide)

        svg.append("path")
          .datum(topojson.mesh(us, us.objects.counties, function(a, b) { return a !== b; }))
          .attr("class", "counties")
          .attr("d", path);

        svg.append("path")
          .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
          .attr("class", "states")
          .attr("d", path);
      }

	  </script>

  </body>
</html>
